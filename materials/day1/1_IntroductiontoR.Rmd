---
title: "Introduction to R and Rmarkdown"
date: "`r Sys.Date()`"
output: pdf_document
---

# Learning objectives:
(1) R and R markdown
(2) Algebra in R
(3) Installing and loading libraries
(4) Setting the working directory
(5) Reading in data sets
(6) Making plots
(7) Writing data files
(8) Organising scripts


# R
R is a free software environment for statistical computing and graphics. One of its strengths is that you can make publication-quality plots.

Rstudio is a flexible and multi-functional open-source IDE (integrated development environment) used as a graphical front-end to work with R.

R is used by typing in commands.  They are entered after the prompt ">" in the Console. After you type a command and its arguments, simply press the Return Key. Separate commands using ";" or with a newline (Enter).

To run the line that says, "hello world!", click anywhere after '''{r} and before ''', then click on "Run" in the top right of this window and select "Run current chunk".


```{r}
"hello world!"

# or

print("hello world!")

```


Like learning any new language, if you get an error, or are not sure how to do something,you can search online for help.  There are many resources and forums for R.  If you want to do a specific task in R, or are receiving an error, someone before you has had the same issue, and you can find trouble-shooting tips online!


## Getting help:
There are different commands to get help for a command.

```{r}

help("print")

# or

?print

# or to get an example of how to use the command

example("print")

# and to start the HTML version of help, type:

help.start()

```


Here are some websites where you can also find help with R:

https://www.rdocumentation.org/ - documentation on R tools and packages

https://search.r-project.org/ - documentation on R tools and packages

https://stackoverflow.com/questions - many questions and solutions already discussed here

https://rstudio.github.io/cheatsheets/html/rstudio-ide.html - RStudio cheatsheet

https://www.tidyverse.org/ - tidyverse website


# R is a calculator

```{r}
1 + 1
```

Try doing this in the console too.


You need to give instructions to R for everything.

We are using RStudio as an interface to better manage our scripts, data, files and figures.

We are working on a Rmarkdown document right now.


# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r}
# This is a new chunk.  For organisational purposes, you can name chunks (this chunk doesn't have 
# a name, but I will name all future chunks).
```


# Types of calculations

Some symbols are familiar (+ addition, - subtraction, / division), while others might be new (* multiplication)

```{r Calculations}

4 + 3

4 - 3

4 / 3

4 * 3

```


We can assign a variable any value.

```{r Variables}

# I prefer this way, because it helps keep your scripts organised
x <- 4

assign("y", 3)

z = 2

```


To see the variables, you can type out the variable name or print(variable name).

```{r Variables part 2}

print(x)

y

```


And then use the variables in calculations.

```{r Calculations with variables}

x + y

x - y

x / y

x * y

3 + y

```


## Exercise 1
1. Make a new R chunk, label it as "Exercise 1"
2. Use the R chunk to write and run four calculations using +, -, * or /, include variables and integers
3. Find a partner and review your results for Exercise 1 (if you're online, share your code in the chat and discuss)


# Vectors

Vectors are a sequence of data that can be numbers, characters or logical values. Elements of a vector must be the same type and mode.  Characters should be in single or double quotes, while missing data can be represented as NA (not available).

```{r How to make a vector}
# A vector with more than one element can be made with c()

m <- c(1,2,NA,4)
m
# to see the type of vector
is(m)

n <- c("A", "mango", NA)
n

```


For logical vectors there are three possible values: TRUE, FALSE, and NA. TRUE can also be represented as T, and FALSE as F.  These logical values can be generated by conditions.  For example:

```{r Logical vectors}

temp <- m > 3

print(temp)

```

Logical operators include: <, <= (less than or equal to), >, >=, == (for equal to), and != (for not equal to). If using more than one condition, use & (and), | (or).


To retrieve or change the value of an element in the vector, use the index of the value.

```{r Using vectors}

v <- c(4,2,3,8,2,2,5)

# To get the fourth element of v
v[4]

# To change the fourth element of v
v[4] <- 10

v

# Logical vectors can be used to retrieve data values

w <- v < 5
v[w]

```


# Matrices 

Data can be stored as a matrix (a rectangular array of data) all of the same mode.

First, make a matrix:

```{r How to make a matrix}

A <- matrix(
    
  # Sequence of elements  
  c(1, 2, 3, 4, 5, 6, 7, 8, 9), 
  
  # No of rows
  nrow = 3,   
  
  # No of columns
  ncol = 3,         
  
  # Matrices are in column-wise order
  # This parameter decides how to arrange the matrix
  byrow = TRUE          
)
 
# Naming rows
rownames(A) = c("a", "b", "c")
 
# Naming columns
colnames(A) = c("c", "d", "e")


# Notice that in R scripts, we use the # to show something is a comment, and not 
# a command
# Use this feature to explain what you are doing (for future use of your scripts 
# and if you share with anyone)

B <- matrix(c(1, 6, 12, 4, 8, 15, 3, 14, 2), nrow = 3, ncol = 3)

print(A)
print(B)

```


Matrices can be added (+), subtracted (-), multiplied (%*%), transposed (t()), inversed (solve()) (and more).

```{r Matrix math}

A + B

A - B

A %*% B

t(A)

solve(B)

```


What is happening to calculate the inverse (-1)?
Here's a 2x2 matrix where we do the inverse by hand

```{r Inverse of matrices by hand}

a <- 2
b <- 5
c <- 9
d <- 7

M <- matrix(c(a, c, b, d), nrow = 2, ncol = 2)


print(M)

determinant_M <- a*d - b*c

adjoint_M <- matrix(c(d, -c, -b, a), nrow = 2, ncol = 2)
# a and d switch positions, b and c change signs

Inverse_M <- 1/determinant_M * adjoint_M

print(Inverse_M)

solve(M)

```


## Exercise 2
1. Make a new R chunk, label it as "Exercise 2"
2. Make at least 3 square matrices (matrices with the same number of rows and columns and save them as variables)
3. Try addition (+), subtraction (-), matrix multiplication (%*%), transpose (t()), and inverse (solve())


# Installing and loading libraries

You only need to install a package once.
```{r Installing}

#install.packages('ggplot2')

```

The next time you run this script, you won't need to run this line again.  To save time, you will want to use the # to make it a comment.  Like this:

You will see this in scripts during this course.  If it is a package you haven't installed yet, just remove the #, run the line, then put the # back in to save you time in the future.


You will need to load packages you want to use every time before you use them.
```{r Loading packages}

library(ggplot2) # loading a library useful for plotting data

```


To view the names of the packages already installed, or those that are loaded:
```{r Loaded packages}

library()

search()

```


## Exercise 3
1. Make a new R chunk, label it as "Exercise 3"
2. Install "lme4" package (this package is used for fitting linear mixed models)
3. Load the "lme4" library


# Setting working directory

There are different ways to set the working directory.  You can click on "Files" , then on the cog (blue thing beside "Rename"), and select "Set As Working Directory".  

I prefer to set the working directory in the script.  This will help you remember which directory you were working in.

When using an Rmarkdown file, the working directory is automatically where your Rmarkdown file is saved.  However, we will go through an example, so you can see how to set your working directory in an r script.

```{r Get and set working directory, warning=FALSE}

getwd() # this will tell you the working directory you are currently in

# This will change your working directory. You can see that I'm changing the working directory to a folder on my desktop that I've made for the CTLGH workshop
#setwd("~/Desktop/CTLGH_Training/Day1/")

# If you are getting an error, double check that the "/" are in the right direction ("\" won't work)

getwd()

# List the contents of your working directory
dir()

```


## Exercise 4
1. Make a new R chunk, label it as "Exercise 4"
2. Set your working directory to the folder you've made on you desktop for this course using setwd()


# Working with larger datasets

We have already worked with 3x3 matrices by writing out each element, and indicating rows and columns.  Anything much larger than this becomes quite labour-intensive, and prone to human error.  We can read in data frames from various file types (.txt, .csv, and even Excel).


```{r Reading in data frames, warning=FALSE}

# Your data should be in the same directory as your Rmarkdown, otherwise, R 
# will not be able to find the file!

traits <- read.table("CT_traits_724_pc_res.csv", h=TRUE, sep=",")

# if you are reading in a .txt file, it would be read.table() instead of 
# read.csv()
# if you want to read in .xls or .xlsx (Excel) files, you can install a package 
# like "readxl" and use the command read_excel().  We recommend using only .csv 
# and .txt files though, to keep life simple.

head(traits) # shows the column names and first few lines of the data frame

```


This is the data set we will be using throughout the workshop this week.  You can find the original publication here: https://doi.org/10.1186/s12711-016-0191-3.

Briefly, we have the carcass composition traits measured using CT scanning on a population of Scottish Blackface sheep.  Principal components PC1, PC2 and PC3 were calculated from SNP array data, and are used to describe population structure.

Definition of Variables
id             : Animal id
sex            : Sex
Year           : Year
dob            : Date of birth
litter         : Litter
LS             : Litter size
DamAge         : Age of dam
Group          : Management group
Line_a         : Line of lamb
LW             : Live weight
bon_area_ISC   : Bone area at the ischium  
mus_density_TV8: Muscle density of eighth thoracic vertebra
PC1            : Principal component 1
PC2            : Principal component 2
PC3            : Principal component 3
rlw            : Live weight residual after correcting for fixed effects
rbon_area      : Bone area residual after correcting for fixed effects
rmus_den       : Muscle density residual after correcting for fixed effects


## Exercise 5
1. Make a new R chunk, label it as "Exercise 5"
2. Read in data using read.csv()


# Manipulating larger datasets

We can pull out single elements, columns or rows from our data frame to work with.

For example, we can produce a summary of data (mean, median, maximum, minimum) using the summary() command.  If we only want a summary for litter size (LS), we have to first specify the data frame name, "traits", followed by "$" and then "LS".


```{r Working with data frames}

summary(traits$LS)

```


We can also specify data using column and row number using the square brackets.

```{r Working with data frames part 2}

summary(traits[,6])

```


R automatically decides what type of variable each column in a data frame contains.

```{r Working with data frames part 3}

str(traits)

```


But variables like sex and litter should be factors.  For example, the way we describe sex in sheep can only be one of two options, 0 or 1, but if we summarise our sex data, we see a mean that is not possible.

```{r Working with data frames part 4}

summary(traits$sex)

```


Sex should be a factor, so we can change it to the correct data type using as.factor().  If you wanted to change a variable to numeric, it's as.numeric(), to a character it's as.character, and so on.

```{r Working with data frames part 5}

traits$sex <- as.factor(traits$sex)
summary(traits$sex)

```


## Exercise 6

1. Make a new R chunk, label it as "Exercise 6"
2. Change 'litter' to a factor in your data frame


# Making and saving plots

Using figures is a great way to visually identify patterns and trends.

```{r Plotting}

plot(traits$PC1, traits$PC2)

```

We can make this look nicer by adding different arguments.  Here we change the shape of the data points using 'pch', and we plot each data point a different colour depending on the line that an animal is in.

```{r Plotting and changing arguments}

plot(traits$PC1, traits$PC2, pch=19, 
     col=c("red", "blue", "yellow", "green","purple", "orange", "turquoise")[traits$Line_a])

# When a line of code doesn't fit on one line, you can put it on multiple lines
# as we've done with plot() here. In the Console, you'll see that instead of the
# ">" for the second part of plot(), there is a "+" instead.

```


## Exercise 7
1. Make a new R chunk, label it as "Exercise 7"
2. Make a new plot of PC2 and PC3
3. Go to Rdocumentation https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/plot and follow instructions to change the x and y axes labels


# Writing data files

We can use R to filter and clean our data so we can use it in other programmes like BLUPF90.  We've read in data, how do we print it out as a new file after we've made changes?


Let's only print out data of sheep from 2001.

```{r Writing a file, warning=FALSE}

sheep_2001 <- subset(traits, Year==2001)

write.table(sheep_2001, "sheep_2001.txt", quote=FALSE, sep=' ', row.names=FALSE)

```


You can also save and load your work space.
```{r Work spaces}

# Save
save.image("saved_workspace.RData")

# Load
load("saved_workspace.RData")

```


# Organising your scripts

1. Always start your script with "rm(list = ls())", this will clean your global environment and make sure you haven't got any old information in there that might confuse what you are working on now.  You will see this line in R scripts in this workshop.

2. Set your working directory with setwd().  Your working directory is unique to your computer!

3. Inputs needed.  Install (if needed) and load libraries, and read in data.

4. Your analyses.

5. Outputs (plots, and any new data frames).

Remember to make comments throughout to explain where data is coming from, what analyses are being done, etc.  This helps you remember what you are doing, and will help when you share scripts with others.


# Conclusions

## Learning objectives:
(1) R and R markdown
(2) Algebra in R
(3) Installing and loading libraries
(4) Setting the working directory
(5) Reading in data sets
(6) Making plots
(7) Writing data files
(8) Organising scripts

Refer back to this document this week, so you can use some of the things you've learned here (copying and pasting into your new scripts).  Every time you open and start working with an R script, you will need to set your working directory.  All of our examples this week will be on the data set we've read in here.


## Exercise 8
1. "Knit" this file to a pdf document (it will save in your working directory)


